# Web版AI旅行规划师 (AI Travel Planner) 需求文档

## 一、项目概述

### 1.1 项目目标

开发一个基于Web的AI旅行规划系统，通过人工智能技术简化旅行规划过程，为用户提供个性化的旅行路线建议和实时旅行辅助。

### 1.2 核心价值

- **智能化规划**：利用AI技术自动生成详细的旅行路线
- **多模态交互**：支持语音和文字输入，提升用户体验
- **云端同步**：实现多设备数据同步，方便用户管理
- **预算管理**：智能费用分析和记录功能

## 二、功能需求规格

### 2.1 核心功能模块

#### 2.1.1 智能行程规划模块

**功能描述**：

- 用户可通过语音或文字输入旅行需求
- AI自动生成个性化旅行路线
- 包含交通、住宿、景点、餐厅等详细信息

**输入参数**：

- 目的地（必填）
- 旅行日期（必填）
- 预算范围（必填）
- 同行人数（必填）
- 旅行偏好（可选）：美食、文化、购物、自然风光等
- 特殊需求（可选）：带孩子、老年人、商务等

**输出内容**：

- 每日行程安排
- 景点推荐及停留时间
- 交通方式建议
- 住宿推荐
- 餐饮建议
- 费用预估

#### 2.1.2 费用预算与管理模块

**功能描述**：

- AI进行预算分析和分配
- 支持语音记录旅行开销
- 实时费用跟踪和提醒

**子功能**：

- 预算分配建议
- 实际开销记录
- 预算执行情况分析
- 超支预警

#### 2.1.3 用户管理与数据存储模块

**功能描述**：

- 用户注册登录系统
- 多份旅行计划管理
- 云端数据同步

**功能细节**：

- 用户注册/登录
- 个人资料管理
- 旅行计划创建/编辑/删除
- 历史计划查看
- 多设备数据（旅行计划、偏好设置、费用记录等）同步

### 2.2 非功能性需求

#### 2.2.1 性能需求

- 页面加载时间：< 3秒
- API响应时间：< 2秒
- 支持并发用户数：≥ 1000
- 数据同步延迟：< 5秒

#### 2.2.2 可用性需求

- 支持主流浏览器：Chrome、Firefox、Safari、Edge
- 响应式设计，支持移动端访问
- 界面简洁直观，操作便捷

#### 2.2.3 安全性需求

- 用户数据加密存储
- API密钥安全管理
- 防止SQL注入和XSS攻击
- 用户身份验证和授权

## 三、技术架构设计

### 3.1 前端技术栈

**推荐方案**：

- **框架**：Vue.js
- **地图组件**：高德地图API
- **UI组件库**：Element UI
- **语音识别**：科大讯飞API
- **状态管理**：Pinia
- **构建工具**：Vite

### 3.2 后端技术栈

**推荐方案**：

- **运行时**：Python + FastAPI
- **数据库**：PostgreSQL (Supabase)
- **认证服务**：Supabase Auth
- **AI服务集成**：阿里云百炼平台
- **文件存储**：云存储服务（阿里云OSS等）

### 3.3 部署架构

- **容器化**：Docker + Docker Compose
- **CI/CD**：GitHub Actions
- **镜像仓库**：阿里云容器镜像服务
- **服务器**：云服务器（ECS）或容器服务

## 四、API设计规范

### 4.1 核心API接口

#### 4.1.1 用户认证API

```
POST /api/v1/auth/register # 用户注册 
POST /api/v1/auth/login # 用户登录 
POST /api/v1/auth/logout # 用户登出 
POST /api/v1/auth/refresh-token # 刷新访问令牌 
```

#### 4.1.2 用户管理API

```
GET /api/v1/users/profile # 获取用户资料 
PUT /api/v1/users/profile # 更新用户资料 
GET /api/v1/users/preferences # 获取用户偏好设置 
PUT /api/v1/users/preferences # 更新用户偏好设置
```

#### 4.1.3 旅行计划API

```
POST /api/v1/trips # 创建旅行计划 
GET /api/v1/trips # 获取旅行计划列表 
GET /api/v1/trips/{trip_id} # 获取旅行计划详情 
PUT /api/v1/trips/{trip_id} # 更新旅行计划 
DELETE /api/v1/trips/{trip_id} # 删除旅行计划 
POST /api/v1/trips/{trip_id}/generate # AI生成行程 
GET /api/v1/trips/{trip_id}/itinerary # 获取行程详情 
PUT /api/v1/trips/{trip_id}/itinerary # 更新行程安排
```

#### 4.1.4 费用管理API

```
POST /api/v1/trips/{trip_id}/expenses # 添加费用记录 
GET /api/v1/trips/{trip_id}/expenses # 获取费用列表 
GET /api/v1/trips/{trip_id}/expenses/{expense_id} # 获取费用详情 
PUT /api/v1/trips/{trip_id}/expenses/{expense_id} # 更新费用记录 
DELETE /api/v1/trips/{trip_id}/expenses/{expense_id} # 删除费用记录 
GET /api/v1/trips/{trip_id}/budget-analysis # 预算分析报告
```

#### 4.1.5 语音识别API

```
POST /api/v1/speech/transcribe # 实时语音转录
```

#### 4.1.6 AI规划API

```
POST /api/v1/ai/plan # AI旅行规划 
```

#### 4.1.7 地图服务API

```
GET /api/v1/maps/geocode # 地址解析 
GET /api/v1/maps/route # 路线规划 
GET /api/v1/maps/poi # 兴趣点搜索 
POST /api/v1/maps/markers # 地图标记管理
```

### 4.2 第三方API集成

- **地图服务**：高德地图API（地理编码、路线规划、POI搜索）
- **语音识别**：科大讯飞API（实时语音转录）
- **AI模型**：阿里云百炼平台（行程规划、推荐算法）
- **天气服务**：和风天气API（天气预报、实时天气）
- **支付接口**：（预留）支付宝/微信支付API

## 五、数据库设计

### 5.1 核心数据表

#### 5.1.1 用户表 (users)

```
id: UUID (主键) email: VARCHAR(255) UNIQUE NOT NULL 
username: VARCHAR(100) NOT NULL 
password_hash: VARCHAR(255) NOT NULL 
avatar_url: VARCHAR(500) # 头像URL 
phone: VARCHAR(20) # 手机号 
date_of_birth: DATE # 出生日期 
gender: VARCHAR(10) # 性别 
is_active: BOOLEAN DEFAULT TRUE # 是否激活 
is_verified: BOOLEAN DEFAULT FALSE # 是否验证 
last_login: TIMESTAMP # 最后登录时间 
created_at: TIMESTAMP DEFAULT NOW() # 创建时间 
updated_at: TIMESTAMP DEFAULT NOW() # 更新时间
```

#### 5.1.2 用户偏好表 (user_preferences)

```
id: UUID (主键) 
user_id: UUID (外键 -> users.id) 
travel_style: VARCHAR(50)[] # 旅行风格数组 
budget_range: JSONB # 预算范围 {min: decimal, max: decimal} 
preferred_accommodation: VARCHAR(50)[] # 住宿偏好 
dietary_restrictions: VARCHAR(100)[] # 饮食限制 
accessibility_needs: BOOLEAN # 无障碍需求 
language_preferences: VARCHAR(10)[] # 语言偏好 
notification_settings: JSONB # 通知设置 
created_at: TIMESTAMP DEFAULT NOW() 
updated_at: TIMESTAMP DEFAULT NOW()
```

#### 5.1.3 旅行计划表 (trips)

```
id: UUID (主键) 
user_id: UUID (外键 -> users.id) 
title: VARCHAR(200) NOT NULL # 旅行标题 
destination: VARCHAR(100) NOT NULL # 目的地 
start_date: DATE NOT NULL # 开始日期 
end_date: DATE NOT NULL # 结束日期 
budget: DECIMAL(10,2) # 总预算 
travelers_count: INTEGER DEFAULT 1 # 同行人数 
travel_style: VARCHAR(50) # 旅行风格 
status: VARCHAR(20) DEFAULT 'draft' # 状态：draft, active, completed, cancelled 
preferences: JSONB # 用户偏好设置 
ai_generated_content: JSONB # AI生成的内容 
created_at: TIMESTAMP DEFAULT NOW() 
updated_at: TIMESTAMP DEFAULT NOW()
```

#### 5.1.4 行程详情表 (trip_itineraries)

```
id: UUID (主键) 
trip_id: UUID (外键 -> trips.id) 
day_number: INTEGER NOT NULL # 第几天 
date: DATE NOT NULL # 具体日期 
activities: JSONB[] # 活动安排数组 
    - type: VARCHAR(50) # 活动类型 
    - time: TIME # 时间 
    - location: VARCHAR(100) # 地点 
    - description: TEXT # 描述 
    - duration_minutes: INTEGER # 持续时间 
    - cost_estimate: DECIMAL(8,2) # 费用预估 
transportation: JSONB # 交通安排 
accommodation: JSONB # 住宿信息 
notes: TEXT # 备注 
created_at: TIMESTAMP DEFAULT NOW() 
updated_at: TIMESTAMP DEFAULT NOW()
```

#### 5.1.5 费用记录表 (expenses)

```
id: UUID (主键) 
trip_id: UUID (外键 -> trips.id) 
category: VARCHAR(50) NOT NULL # 费用类别 
amount: DECIMAL(10,2) NOT NULL # 金额 
currency: VARCHAR(3) DEFAULT 'CNY' # 货币 
description: TEXT # 描述 
expense_date: DATE NOT NULL # 消费日期 
payment_method: VARCHAR(50) # 支付方式 
receipt_url: VARCHAR(500) # 收据URL 
is_planned: BOOLEAN DEFAULT FALSE # 是否为计划内支出 
tags: VARCHAR(50)[] # 标签 
created_at: TIMESTAMP DEFAULT NOW() 
updated_at: TIMESTAMP DEFAULT NOW()
```

#### 5.1.6 景点推荐表 (poi_recommendations)

```
id: UUID (主键) 
trip_id: UUID (外键 -> trips.id) 
poi_name: VARCHAR(200) NOT NULL # 景点名称 
poi_type: VARCHAR(50) NOT NULL # 类型：attraction, restaurant, hotel等 
location: VARCHAR(100) # 位置 
latitude: DECIMAL(10,8) # 纬度 
longitude: DECIMAL(11,8) # 经度 
rating: DECIMAL(3,2) # 评分 
price_range: VARCHAR(20) # 价格范围 
description: TEXT # 描述 
recommendation_reason: TEXT # 推荐理由 
is_selected: BOOLEAN DEFAULT FALSE # 是否被用户选择 
created_at: TIMESTAMP DEFAULT NOW()
```

#### 5.1.7 语音记录表 (voice_records)

```
id: UUID (主键) 
user_id: UUID (外键 -> users.id) 
trip_id: UUID (外键 -> trips.id) # 可为空，如果不是旅行相关 
audio_url: VARCHAR(500) NOT NULL # 音频文件URL 
transcribed_text: TEXT # 转录文本 
duration_seconds: INTEGER # 音频时长 
language: VARCHAR(10) DEFAULT 'zh-CN' # 语言 
purpose: VARCHAR(50) # 用途：expense, note, plan等 
created_at: TIMESTAMP DEFAULT NOW()
```

#### 5.1.8 系统配置表 (system_configs)

```
id: UUID (主键) 
config_key: VARCHAR(100) UNIQUE NOT NULL # 配置键 
config_value: JSONB NOT NULL # 配置值 
description: TEXT # 描述 
is_active: BOOLEAN DEFAULT TRUE # 是否激活 
created_at: TIMESTAMP DEFAULT NOW() 
updated_at: TIMESTAMP DEFAULT NOW()
```

### 5.2 数据库索引设计

```sql
-- 用户表索引
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_created_at ON users(created_at);

-- 旅行计划表索引
CREATE INDEX idx_trips_user_id ON trips(user_id);
CREATE INDEX idx_trips_destination ON trips(destination);
CREATE INDEX idx_trips_start_date ON trips(start_date);
CREATE INDEX idx_trips_status ON trips(status);

-- 费用记录表索引
CREATE INDEX idx_expenses_trip_id ON expenses(trip_id);
CREATE INDEX idx_expenses_expense_date ON expenses(expense_date);
CREATE INDEX idx_expenses_category ON expenses(category);

-- 行程详情表索引
CREATE INDEX idx_itineraries_trip_id ON trip_itineraries(trip_id);
CREATE INDEX idx_itineraries_date ON trip_itineraries(date);
```

### 5.3 数据关系说明

- **一对多关系**：用户 → 旅行计划 → 行程详情/费用记录
- **扩展性设计**：使用JSONB字段存储动态数据，便于功能扩展
- **审计字段**：所有表包含created_at和updated_at字段
- **软删除**：通过status字段实现软删除，保留历史数据

## 六、界面设计规范

### 6.1 页面结构

1. **首页**：旅行规划入口、特色功能展示
2. **规划页面**：需求输入、AI规划结果展示
3. **行程详情页**：详细行程安排、地图展示
4. **费用管理页**：预算分析、费用记录
5. **用户中心**：个人信息、历史计划管理

### 6.2 交互设计原则

- **语音优先**：语音输入作为主要交互方式
- **地图为中心**：行程在地图上可视化展示
- **响应式布局**：适配不同屏幕尺寸
- **渐进式加载**：优化大内容页面的加载体验

## 七、开发计划

### 7.1 阶段划分

**第一阶段（2周）**：基础架构搭建

- 项目初始化
- 数据库设计
- 用户认证系统
- 基础UI组件

**第二阶段（3周）**：核心功能开发

- 行程规划算法
- 地图集成
- 语音识别功能
- 费用管理模块

**第三阶段（2周）**：优化和测试

- 性能优化
- 安全测试
- 用户体验优化
- 部署配置

### 7.2 里程碑

- **M1**：完成用户认证系统
- **M2**：实现基础行程规划功能
- **M3**：集成语音识别和地图服务
- **M4**：完成所有核心功能
- **M5**：部署上线和测试

## 八、部署和运维

### 8.1 部署要求

- **Docker镜像**：提供可直接运行的容器镜像
- **环境配置**：通过环境变量管理API密钥
- **数据库备份**：定期自动备份机制
- **监控告警**：系统性能监控和异常告警

### 8.2 安全规范

- **API密钥管理**：不在代码中硬编码密钥
- **输入验证**：所有用户输入进行严格验证
- **数据加密**：敏感数据加密存储
- **访问控制**：基于角色的权限管理

## 九、测试策略

### 9.1 测试类型

- **单元测试**：核心业务逻辑测试
- **集成测试**：API接口测试
- **端到端测试**：完整业务流程测试
- **性能测试**：系统负载测试

### 9.2 测试工具

- **前端测试**：Jest + Testing Library
- **后端测试**：Jest/Supertest 或 pytest
- **E2E测试**：Cypress 或 Playwright
- **性能测试**：k6 或 Apache JMeter

## 十、项目交付物

### 10.1 代码仓库要求

- GitHub公开仓库
- 详细的提交记录
- 完整的README文档
- Dockerfile和部署脚本

### 10.2 文档要求

- **技术文档**：API文档、架构说明
- **用户手册**：使用指南、功能介绍
- **部署指南**：环境配置、运行说明
- **测试报告**：测试用例和结果

### 10.3 交付格式

- PDF文档（包含GitHub地址和README）
- Docker镜像文件
- 可运行的演示环境

---

**文档版本**：v2.0
**负责人**：AI4SE Homework3 项目组
